{"slots":{"0":{"name":"core","type":{"events":[],"methods":[]}},"1":{"name":"screen","type":{"events":[],"methods":[]}},"2":{"name":"slot3","type":{"events":[],"methods":[]}},"3":{"name":"slot4","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-2":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"unit.hide()\n\nlocal coreHP = core.getMaxHitPoints()\nif coreHP > 10000 then\n    corePositionOffset = 128 * 4\nelseif coreHP > 1000 then\n    corePositionOffset = 64 * 4\nelseif coreHP > 150 then\n    corePositionOffset = 32 * 4\nelse\n    corePositionOffset = 16 * 4\nend\n\n\nelementsID = core.getElementIdList()\ndmgReport = [[<svg version=\"1.1\"\nbaseProfile=\"full\"\nwidth=\"1024\" height=\"612\"\nxmlns=\"http://www.w3.org/2000/svg\">\n\t\n\t<g transform=\"scale(2)\">\n%s\n\n%s\n\t</g>\n<text x=\"18\" y=\"64\" fill=\"white\" text-anchor=\"start\" style=\"font-size: 48pt;\">Damage Report</text>\n</svg>]]\n\ngenericElementTemplate = [[<circle cx=\"%.2f\" cy=\"%.2f\" r=\"3\" fill=\"%s\" />]]\natmoEngineTemplate = [[<svg x=\"%.2f\" y=\"%.2f\"><g style=\"fill:%s;stroke:#000000;stroke-width:1.5px;\">\n<path d=\"M 5.5146787,1.0064811 H 7.3088078 V 0.1322915 H 9.1029365 V 1.0064811 H 10.897066 V 0.1322915 h 1.794129 v 0.8741896 h 1.794127 l 5.382386,5.2451415 v 3.4967587 l -5.382386,5.2451377 h -1.794127 v 0.87419 h -1.794129 v -0.87419 H 9.1029365 v 0.87419 H 7.3088078 v -0.87419 H 5.5146787 L 0.1322915,9.7483813 V 6.2516226 Z\" />\n<path d=\"M 7.3088078,1.0064819 V 14.993519\" />\n<path d=\"M 9.1029365,1.0064819 V 14.993519\" />\n<path d=\"M 10.897066,1.0064811 V 14.993519\" />\n<path d=\"M 12.691195,1.0064819 V 14.993519\" />\n</g></svg>]]\nspaceEngineTemplate = [[<svg x=\"%.2f\" y=\"%.2f\"><g style=\"fill:%s;stroke:#000000;stroke-width:1.5px;\">\n<path d=\"m 6.0108896,1.0064809 h 1.959533 V 0.1322915 H 9.9299543 V 1.0064809 H 11.88949 V 0.1322915 h 1.959533 v 0.8741894 l 0.140086,5.2362854 5.878599,-5.24513944 V 14.984664 L 13.989109,9.7395241 13.849023,14.993519 v 0.87419 H 11.88949 v -0.87419 H 9.9299543 v 0.87419 H 7.9704226 v -0.87419 H 6.0108896 L 0.13229149,9.7483797 V 6.2516203 Z\" />\n<path d=\"M 7.9704226,1.0064809 V 14.993519\" />\n<path d=\"M 9.9299543,1.0064809 V 14.993519\" />\n<path d=\"M 11.88949,1.0064809 V 14.993519\" />\n<path d=\"M 13.849023,1.0064809 V 14.993519\" />\n</g></svg>]]\nairBrakeTemplate = [[<svg x=\"%.2f\" y=\"%.2f\"><g style=\"fill:%s;stroke:#000000;stroke-width:1.5px;\">\n<path d=\"M 19.867708,4.6322915 H 17.245685 L 15.875,2.6458333 h -2.645833 l -1.29756,1.9864582 H 7.9711159 L 6.6145833,2.6458333 H 3.96875 L 2.6069058,4.6322915 H 0.1322915 V 6.7900556 H 1.2287029 V 8.9478227 H 0.1322915 V 11.105588 H 2.6069058 L 3.96875,13.229167 h 2.6458333 l 1.4066654,-2.123579 h 3.9103583 l 1.29756,2.123579 H 15.875 l 1.220286,-2.123579 h 2.772422 V 8.9478227 H 18.771296 V 6.7900556 h 1.096412 V 4.6322915\" />\n<path d=\"M 1.2287029,6.7900554 H 18.771296 V 8.9478225 H 1.2287029 Z\" />\n</g></svg>]]\nspaceBrakeTemplate = [[<svg x=\"%.2f\" y=\"%.2f\"><g style=\"fill:%s;stroke:#000000;stroke-width:1.5px;\">\n<path d=\"M 19.867708,4.6322915 H 17.245685 L 14.552083,2.6458333 11.931607,4.6322915 H 7.9711159 L 5.2916667,2.6458333 2.6069058,4.6322915 H 0.1322915 V 6.7900556 H 1.2287029 V 8.9478227 H 0.1322915 v 2.1577653 h 2.4746143 l 2.6847609,2.123579 2.729582,-2.123579 h 3.9103583 l 2.620476,2.123579 2.543203,-2.123579 h 2.772422 V 8.9478227 H 18.771296 V 6.7900556 h 1.096412 V 4.6322915\" />\n<path d=\"M 1.2287029,6.7900554 H 18.771296 V 8.9478225 H 1.2287029 Z\" />\n</g></svg>]]\nadjustorTemplate = [[<svg x=\"%.2f\" y=\"%.2f\"><g style=\"fill:%s;stroke:#000000;stroke-width:1.5px;\">\n<path d=\"M 19.917842,8.5728619 11.75846,8.5741619 17.0036,2.695563 H 3.0165627 l 5.245139,5.8785989 -8.0792774,-0.0013 v 2.1577641 h 1.0964114 v 2.157767 H 0.1824243 v 2.157765 H 19.917842 V 12.888393 H 18.82143 v -2.157767 h 1.096412 V 8.5728619\" />\n<path d=\"M 1.2788357,10.730626 H 18.82143 v 2.157767 H 1.2788357 Z\" />\n</g></svg>]]\ncustomElementTemplate = [[<svg x=\"%.2f\" y=\"%.2f\"><g style=\"fill:%s;stroke:#000000;stroke-width:1.5px;\">\n<path d=\"\" />\n</g></svg>]]\nyOffset = 0 --export; Damage Report Y Offset\nxScale = 1 --export; Damage Report X Scale\nyScale = 1 --export; Damage Report Y Scale\n\nsvgPixelWidth = 512/100\nsvgPixelHeight = 306/100\n\nfunction updateDMGReport()\n\n    local elements = \"\"\n\n    local broken_count = 0\n    local broken_elements = \"\"\n\n    for _,id in pairs(elementsID) do\n        local max_hp = core.getElementMaxHitPointsById(id)\n        local curr_hp = core.getElementHitPointsById(id)\n\n        local name = core.getElementNameById(id)\n\n        local position = core.getElementPositionById(id)\n        local vector_position = vec3(position)\n        elemPos = {}\n        elemPos.x = ( 50 + ( ( ( ((vector_position.x*4) - corePositionOffset) * xScale ) / corePositionOffset ) * 100) ) * svgPixelWidth\n        elemPos.y = (( 50 - ( ( ( ((vector_position.y*4) - corePositionOffset) * yScale ) / corePositionOffset ) * 100) ) - yOffset) * svgPixelHeight\n        --elemPos.z = math.floor( ( ((vector_position.z*4) - corePositionOffset)  ) )\n\n        local elementType = core.getElementTypeById(id)\n        local elementTemplate = genericElementTemplate\n        if string.find(elementType, \"Atmospheric Engine\") then\n            elemPos.x = elemPos.x-10\n            elemPos.y = elemPos.y-8\n            elementTemplate = atmoEngineTemplate\n        elseif string.find(elementType, \"Space Engine\") then\n            elemPos.x = elemPos.x-10\n            elemPos.y = elemPos.y-8\n            elementTemplate = spaceEngineTemplate\n        elseif string.find(elementType, \"Airbrake\") then\n            elemPos.x = elemPos.x-10\n            elemPos.y = elemPos.y-8\n            elementTemplate = airBrakeTemplate\n        elseif string.find(elementType, \"Retro\") then\n            elemPos.x = elemPos.x-10\n            elemPos.y = elemPos.y-8\n            elementTemplate = spaceBrakeTemplate\n        elseif string.find(elementType, \"Adjustor\") then\n            elemPos.x = elemPos.x-10\n            elemPos.y = elemPos.y-8\n            elementTemplate = adjustorTemplate\n            --elseif string.find(elementType, \"xxx\") then\n            --system.print(elementType)\n        end\n\n        if curr_hp == 0 then\n            broken_count = broken_count + 1\n            broken_elements = broken_elements .. string.format(elementTemplate, elemPos.x, elemPos.y, \"red\")\n        elseif curr_hp < max_hp then\n            broken_count = broken_count + 1\n            broken_elements = broken_elements .. string.format(elementTemplate, elemPos.x, elemPos.y, \"orange\")\n        else\n            elements = elements .. string.format(elementTemplate, elemPos.x, elemPos.y, \"green\")\n        end\n\n    end\n\n    local damageReport = string.format(dmgReport, elements, broken_elements)\n    screen.setHTML(damageReport)\nend\n\nupdateDMGReport()\nunit.setTimer(\"updateDMG\", 15) -- 15 seconds","filter":{"args":[],"signature":"start()","slotKey":"-1"},"key":"0"},{"code":"updateDMGReport()","filter":{"args":[{"value":"updateDMG"}],"signature":"tick(timerId)","slotKey":"-1"},"key":"1"}],"methods":[],"events":[]}
